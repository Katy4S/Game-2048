const t=new class{constructor(){this.board=this.createEmptyBoard(),this.score=0,this.status="idle"}getState(){return this.board}getScore(){return this.score}getStatus(){return this.status}start(){this.board=this.createEmptyBoard(),this.score=0,this.status="playing",this.addNewTile(),this.addNewTile()}restart(){this.start()}createEmptyBoard(){return Array.from({length:4},()=>[,,,,].fill(0))}addNewTile(){let t=this.getEmptyCells();if(t.length){let{r:e,c:s}=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4}}getEmptyCells(){return this.board.flatMap((t,e)=>t.map((t,s)=>0===t?{r:e,c:s}:null)).filter(Boolean)}moveLeft(){return this.shiftTiles(t=>this.mergeRow(t))}moveRight(){return this.shiftTiles(t=>this.mergeRow(t.slice().reverse()).reverse())}moveUp(){this.transposeBoard();let t=this.moveLeft();return this.transposeBoard(),t}moveDown(){this.transposeBoard();let t=this.moveRight();return this.transposeBoard(),t}shiftTiles(t){let e=!1,s=this.board.map(s=>{let r=t(s);return JSON.stringify(s)!==JSON.stringify(r)&&(e=!0),r});return e&&(this.board=s,this.addNewTile(),this.checkGameOver()),e}mergeRow(t){let e=t.filter(t=>0!==t),s=[];for(let t=0;t<e.length;t++)e[t]===e[t+1]?(s.push(2*e[t]),this.score+=2*e[t],t++):s.push(e[t]);for(;s.length<4;)s.push(0);return s}transposeBoard(){this.board=this.board[0].map((t,e)=>this.board.map(t=>t[e]))}checkGameOver(){this.board.some(t=>t.includes(2048))?this.status="win":0!==this.getEmptyCells().length||this.canMerge()||(this.status="lose")}canMerge(){return this.board.some((t,e)=>t.some((s,r)=>0!==s&&(r<3&&s===t[r+1]||e<3&&s===this.board[e+1][r])))}},e=document.querySelector(".button.start"),s=document.querySelector(".game-score"),r=document.querySelector(".game-field"),o=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),i=document.querySelector(".message-start");function n(){s.textContent=t.getScore(),t.getState().forEach((t,e)=>t.forEach((t,s)=>(function(t,e,s){let o=r.rows[t].cells[e];o.className="field-cell",s?(o.classList.add(`field-cell--${s}`),o.textContent=s):o.textContent=""})(e,s,t))),o.classList.toggle("hidden","win"!==t.getStatus()),a.classList.toggle("hidden","lose"!==t.getStatus())}document.addEventListener("keydown",e=>(function(e){if("playing"!==t.getStatus())return;let s={ArrowLeft:()=>t.moveLeft(),ArrowRight:()=>t.moveRight(),ArrowUp:()=>t.moveUp(),ArrowDown:()=>t.moveDown()};s[e]&&s[e]()&&n()})(e.key)),e.addEventListener("click",function(){"idle"===t.getStatus()||"lose"===t.getStatus()||"win"===t.getStatus()?(t.start(),i.classList.add("hidden"),e.textContent="Restart",e.classList.add("restart")):t.restart(),n()}),n();
//# sourceMappingURL=Game-2048.c2fe2c8b.js.map
